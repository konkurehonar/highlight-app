Stack.md
# پشته فناوری (Tech Stack) پروژه کوشک کنکورهنر

![نمودار پشته فناوری](assets/images/tech-stack-diagram.jpeg)

## معماری و ساختار وب‌اپلیکیشن

برای این پروژه سئو-محور، از معماری Monorepo ماژولار استفاده می‌کنیم که شامل زیرسیستم‌های مستقل اما یکپارچه است. هر ماژول به عنوان یک پکیج مجزا در مخزن کد، وظیفه مشخصی را بر عهده دارد.

### ماژول‌های اصلی

#### 1. ماژول احراز هویت (Authentication)
- استفاده از سرویس احراز هویت Supabase
- پشتیبانی از ورود/ثبت‌نام با ایمیل و رمز عبور
- قابلیت افزودن OAuth در آینده
- پیاده‌سازی در فرانت‌اند (Next.js) و بک‌اند (Rust)

#### 2. ماژول پروفایل کاربر (User Profile)
- توابع CRUD برای مدیریت اطلاعات کاربری
- ذخیره‌سازی داده‌ها در PostgreSQL/Supabase
- طراحی جدول `profiles` در Supabase

#### 3. ماژول بلاگ و پایگاه دانش (Blog)
- مدیریت دسته‌بندی‌ها، مقالات و پست‌ها
- اپلیکیشن Next.js برای صفحات بلاگ با SSG/SSR برای SEO
- API در Rust برای عملیات پایه
- ویژگی‌های هر پست: عنوان، توضیحات متا، وضعیت (قفل/منتشر)

#### 4. ماژول مدیریت محتوا (Content Management)
- استفاده از AppFlowy به عنوان ابزار ویرایش محتوا
- مدیریت متن‌ها و ساختار صفحات
- یکپارچه‌سازی با Supabase
- قابلیت self-host کردن AppFlowy با پروژه Supabase

#### 5. ماژول فضای کاری (Workspace)
- محیط کاری کاربر برای مشاهده پیشرفت و امتیازات
- سیستم گیمیفیکیشن
- رابط کاربری اختصاصی در Next.js

#### 6. ماژول نقش‌ها (Roles)
- تعریف سطوح دسترسی (کاربر عادی، مدیر، ویرایشگر)
- استفاده از Row Level Security در Postgres/Supabase
- کنترل دسترسی‌ها براساس نقش‌ها

### مدیریت Monorepo

برای مدیریت Monorepo و هماهنگی ماژول‌ها، از Yarn Workspaces یا Nx استفاده می‌کنیم. این ابزارها امکان نگهداری پروژه‌های متعدد در یک مخزن و اشتراک‌گذاری کد بین ماژول‌ها را فراهم می‌کنند.

**مزایای استفاده از Monorepo:**
- تنظیمات تست و CI/CD در یک محل مشترک
- ساده‌سازی انتشار و به‌روزرسانی بسته‌ها
- امکان اعمال تغییرات سرتاسری با یک کامیت atomic

## تکنولوژی‌های پیشنهادی

### 1. فرانت‌اند
- **فریم‌ورک**: Next.js (React)
- **دلایل انتخاب**:
  - پشتیبانی از SSR/SSG برای بهینه‌سازی SEO
  - عملکرد بهتر نسبت به Flutter Web در زمینه SEO
  - اکوسیستم غنی و پشتیبانی گسترده
- **راه‌اندازی**: `npx create-next-app@latest --example with-jest`

### 2. بک‌اند
- **زبان و فریم‌ورک**: Rust با Actix-Web، Axum یا Rocket
- **دلایل انتخاب**:
  - امنیت و کارایی بالا
  - مدیریت حافظه ایمن
  - عملکرد سریع
- **یکپارچه‌سازی**: استفاده از افزونه `@monodon/rust` در Nx

### 3. مدیریت محتوا
- **ابزار**: AppFlowy
- **کاربرد**:
  - ویرایش صفحات و دسته‌بندی‌های بلاگ
  - مدیریت متن با فرمت Markdown
  - ارتباط با Supabase به عنوان کلاینت

### 4. دیتابیس
- **سرویس**: Supabase (PostgreSQL)
- **کاربرد**:
  - ذخیره اطلاعات کاربران، پروفایل‌ها، دسته‌بندی‌ها و پست‌ها
  - دسترسی کامل به قابلیت‌های Postgres
  - ابزارهای مدیریت شامل داشبورد و سیستم احراز هویت

### 5. کانتینر و استقرار
- **ابزار**: Docker Compose
- **محیط توسعه محلی**: Colima (جایگزین Docker Desktop برای macOS)
- **سرویس‌های کانتینری**:
  - Next.js (خروجی `npm run build && npm run start`)
  - Rust API (اجرای باینری Rust)
  - AppFlowy (در صورت self-host)
  - Postgres/Supabase (یا اتصال به سرویس ابری)

### 6. تست و دیباگ
- **فرانت‌اند**: Jest و React Testing Library
- **بک‌اند**: `cargo test` در Rust
- **مدیریت تست**: Nx و پلاگین `@nx/jest` برای اجرای موازی تست‌ها
- **ساختار**: هر ماژول دارای پوشه تست جداگانه

## توسعه سریع MVP (نسخه اولیه محصول)

### 1. ایجاد Workspace/Monorepo
- استفاده از `yarn init -y` و فعال‌سازی workspaces در package.json
- یا استفاده از Nx: `npx create-nx-workspace`
- ساخت ساختار پایه برای فرانت‌اند، بک‌اند و کتابخانه‌های مشترک

### 2. پیاده‌سازی اسکلت Next.js
- ایجاد پروژه با `npx create-next-app`
- پیکربندی Router و صفحات داینامیک برای بلاگ و دسته‌بندی‌ها
- تنظیم SEO اولیه

### 3. توسعه API در Rust
- ایجاد پروژه Rust در پوشه مجزا (مثلاً `apps/api`)
- استفاده از Actix-Web و افزودن آن به Cargo.toml
- ایجاد API‌های REST برای دسته‌بندی‌ها و پست‌ها

### 4. راه‌اندازی Supabase
- ایجاد پروژه در داشبورد Supabase
- ساخت جداول مورد نیاز:
  - جدول پروفایل‌ها
  - جدول دسته‌بندی‌ها (categories)
  - جدول پست‌ها (posts)
- فعال‌سازی احراز هویت و تنظیم RLS

### 5. پیکربندی AppFlowy
- راه‌اندازی AppFlowy به صورت self-host
- اتصال به دیتابیس Supabase/Postgres
- ایجاد صفحات پیش‌نویس بلاگ

### 6. تنظیم Docker Compose محلی
- ایجاد فایل `docker-compose.yml` برای سرویس‌های اصلی
- استفاده از Colima برای اجرای محیط توسعه
- تنظیم شبکه، ولوم‌ها و متغیرهای محیطی

### 7. پیاده‌سازی تست‌ها
- تنظیم ساختار تست در هر ماژول
- نوشتن تست‌های اولیه با Jest و Testing Library
- ایجاد تست‌های مشترک برای کامپوننت‌های عمومی
- استفاده از `cargo test` برای بک‌اند Rust

### 8. ورود داده‌های اولیه
- استفاده از اسکریپت Seed برای دسته‌بندی‌ها و پست‌های اولیه
- ایجاد فایل `supabase/seed.sql` برای ورود داده‌های پایه:

```sql
INSERT INTO categories (id, name) VALUES (1, 'تاریخ هنر'), (2, 'نقاشی');
INSERT INTO posts (id, title, category_id, status, content) VALUES 
  (1, 'نقاشی کلاسیک', 2, 'locked', 'به‌زودی...'),
  (2, 'دوره رنسانس', 1, 'locked', 'به‌زودی...');
9. چک‌لیست آماده‌سازی
بررسی اجرای بدون خطای سرویس‌ها در Docker Compose
تست عملیات ورود/خروج کاربران
آزمایش صفحات بلاگ و دسته‌بندی با داده‌های قفل‌شده
بررسی دکمه‌ها و ناوبری
رفع باگ‌ها و ایرادات
10. استقرار در VPS
آماده‌سازی تصویر نهایی با Docker Compose
پیکربندی سرور VPS
نصب Docker و Docker Compose
کلون پروژه و اجرا با docker-compose up -d
استقرار در VPS پارس‌پک
مشخصات سرور مورد نیاز
سیستم‌عامل: لینوکس (Ubuntu 22.04 LTS)
منابع پیشنهادی: 2 CPU و 4GB RAM
فضای ذخیره‌سازی: 25-50 گیگابایت SSD
هزینه تقریبی: 5-15 دلار در ماه
مزایای استفاده از VPS پارس‌پک
دسترسی root برای نصب ابزارهای توسعه
کاهش تاخیر شبکه برای کاربران ایرانی (دیتاسنتر داخلی)
امکان نصب Docker و سایر ابزارهای مورد نیاز
نکات مهم
اطمینان از آی‌پی ثابت (به‌ویژه برای دامنه‌های .ir)
فعال‌سازی پشتیبان‌گیری خودکار
تنظیم فایروال (حداقل برای پورت SSH/22)
تست‌پذیری با Jest و ساختار ماژولار
استراتژی تست
تست مجزای هر ماژول
استفاده از Jest همراه با React Testing Library در فرانت‌اند
بهره‌گیری از cargo test در بک‌اند Rust
استفاده از Nx برای تسهیل مدیریت تست‌ها
ساختار تست‌ها
ایجاد پوشه tests/ یا __tests__ در هر ماژول
استفاده از #[cfg(test)] در ماژول‌های Rust
امکان اجرای یکپارچه تست‌ها با دستورات npm test و cargo test
چک‌لیست گام‌به‌گام شروع پروژه
ایجاد Monorepo
راه‌اندازی با Nx یا Yarn Workspaces
ساختار پوشه‌ها: apps/ برای Next.js و API، libs/ برای کتابخانه‌های مشترک
تنظیم ماژول احراز هویت
استفاده از Supabase Auth
پیاده‌سازی ورود/ثبت‌نام با ایمیل و رمز عبور
ایجاد صفحات لاگین/رجیستر در Next.js
ساخت ماژول بلاگ
ایجاد صفحات داینامیک برای دسته‌ها و پست‌ها
پیاده‌سازی API در Rust برای دریافت داده‌ها از Supabase
ایجاد جداول در Supabase
ساخت جداول categories، posts و profiles
تنظیم روابط بین جداول (مثلاً رابطه پست با دسته)
راه‌اندازی AppFlowy
اجرای AppFlowy به صورت self-host
اتصال به دیتابیس Supabase
تولید محتوای اولیه بلاگ
کانتینریزه کردن پروژه
نوشتن Dockerfile و docker-compose.yml
تست اجرای محلی با docker-compose up
نوشتن تست‌ها
پیکربندی Jest در پروژه Next.js
نوشتن تست‌های واحد اولیه
اجرای npm test و رفع اشکالات
ورود داده‌های اولیه
اجرای اسکریپت‌های Seed در Supabase
افزودن دسته‌ها و پست‌های قفل‌شده اولیه
تست عملکردها
بررسی نمایش پست‌های قفل‌شده
تست فرآیند ورود/خروج کاربران
تست سیستم انتشار محتوا
تنظیم VPS و استقرار
انتخاب پلن مناسب VPS در پارس‌پک
نصب Docker و Docker Compose
کلون پروژه و اجرای نهایی
بررسی صحت عملکرد در محیط واقعی (HTTP, SSL, DNS)
